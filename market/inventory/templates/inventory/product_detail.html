{% extends 'base.html' %}

{% block content %}
<div class="d-flex align-items-center mb-3">
  <a href="{% url 'inventory:products' %}" class="me-3">&larr; Back to list</a>
  <h3 class="m-0">Product details</h3>
</div>

<div class="card">
  <div class="card-body">
    <h5 class="card-title">{{ product.name }}</h5>
    <p class="card-text"><strong>Price per unit:</strong> {{ product.unit_price }}</p>
    <p class="card-text"><strong>Unit:</strong> {{ product.get_unit_display }}</p>
    <p class="card-text"><strong>Quantity:</strong> {{ product.quantity }}</p>
    {% if product.owner %}
    <p class="card-text"><strong>Owner:</strong> {{ product.owner }}</p>
    {% endif %}
    {% if avg_rating %}
    <p class="card-text"><strong>Average rating:</strong> 
      {% for _ in "x"|ljust:avg_rating|floatformat:0 %}
        ⭐️
      {% endfor %}
      ({{ avg_rating }} / 5)
    </p>
    {% else %}
    <p class="card-text text-muted">No ratings yet</p>
    {% endif %}

    <div class="mt-3">
      {% if user.is_authenticated %}
      <form method="post" class="d-flex align-items-center gap-2">
        {% csrf_token %}
        <label for="rating_select" class="mb-0 small">Your rating:</label>
        <select id="rating_select" name="rating" class="form-select form-select-sm" style="width:100px;">
          <option value="1" {% if user_rating and user_rating.value == 1 %}selected{% endif %}>⭐️</option>
          <option value="2" {% if user_rating and user_rating.value == 2 %}selected{% endif %}>⭐️⭐️</option>
          <option value="3" {% if user_rating and user_rating.value == 3 %}selected{% endif %}>⭐️⭐️⭐️</option>
          <option value="4" {% if user_rating and user_rating.value == 4 %}selected{% endif %}>⭐️⭐️⭐️⭐️</option>
          <option value="5" {% if user_rating and user_rating.value == 5 %}selected{% endif %}>⭐️⭐️⭐️⭐️⭐️</option>
        </select>
        <button class="btn btn-sm btn-outline-primary" type="submit">Rate</button>
      </form>
      {% else %}
      <p class="text-muted">Please <a href="{% url 'auth:login' %}?next={% url 'inventory:product_detail' product.pk %}">login</a> to rate this product.</p>
      {% endif %}
    </div>

    <div class="mt-3">
      <a href="{% url 'inventory:edit_product' product.pk %}" class="btn btn-primary btn-sm">Edit</a>
      <form method="post" action="{% url 'inventory:delete_product' product.pk %}" style="display:inline">
        {% csrf_token %}
        <button type="submit" class="btn btn-danger btn-sm ms-2" onclick="return confirm('Delete this product?')">Delete</button>
      </form>
    </div>
  </div>
</div>

{% endblock content %}
